<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Page Title & Description -->
  <title>Friend Requests & Create Bot ‚Äî Botnev</title>
  <meta name="description" content="Manage friend requests and create your own AI bot on Botnev! Customize your bot, select voices, and models.">

  <!-- Open Graph (for social media sharing) -->
  <meta property="og:title" content="Friend Requests & Create Bot ‚Äî Botnev">
  <meta property="og:description" content="Manage friend requests and create your own AI bot on Botnev! Customize your bot, select voices, and models.">
  <meta property="og:image" content="https://botnet2.netlify.app/assets/og-image.png">
  <meta property="og:url" content="https://botnet2.netlify.app/create-bot.html">
  <meta property="og:type" content="website">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Friend Requests & Create Bot ‚Äî Botnev">
  <meta name="twitter:description" content="Manage friend requests and create your own AI bot on Botnev! Customize your bot, select voices, and models.">
  <meta name="twitter:image" content="https://botnet2.netlify.app/assets/og-image.png">

  <!-- Structured Data (JSON-LD) -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Friend Requests & Create Bot ‚Äî Botnev",
      "url": "https://botnet2.netlify.app/create-bot.html",
      "description": "Manage friend requests and create your own AI bot on Botnev! Customize your bot, select voices, and models.",
      "publisher": {
        "@type": "Organization",
        "name": "Botnev",
        "logo": {
          "@type": "ImageObject",
          "url": "https://botnet2.netlify.app/assets/logo.png"
        }
      }
    }
  </script>

  <!-- External CSS -->
  <link rel="stylesheet" href="style.css">

  <!-- Internal Styles (This can be moved to style.css later) -->
  <style>
    body { font-family: Arial, sans-serif; background:#f9fafc; margin:0; padding:20px; text-align:center; display: flex; height: 100vh; }
    h1 { color:#333; }
    .sidebar { position: fixed; top: 0; left: 0; height: 100%; width: 250px; background: #ffffff; box-shadow: 2px 0 5px rgba(0,0,0,0.1); padding: 20px; overflow-y: auto; }
    .sidebar-scroll { display: flex; flex-direction: column; gap: 15px; }
    .btn { background: #007bff; color: white; padding: 10px 15px; border-radius: 8px; text-align: center; cursor: pointer; }
    .btn:hover { background: #0056b3; }
    .content { margin-left: 270px; padding: 20px; flex-grow: 1; }
    .profile-header { display: flex; align-items: center; justify-content: center; margin-bottom: 20px; gap: 15px; }
    .profile-header img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; }
    .online { color: lime; font-weight: bold; }
    .offline { color: gray; font-weight: bold; }
    .output { margin-top: 15px; font-family: monospace; padding: 10px; border-radius: 6px; }
    .output.success { background: #e6ffed; color: #256d1b; border: 1px solid #8dd48a; }
    .output.error { background: #ffe6e6; color: #a12626; border: 1px solid #f5a3a3; }
    .links-container { margin-top: 25px; display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; }
    .links-container a { padding: 8px 15px; background: #fff; border-radius: 8px; text-decoration: none; color: #007bff; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: 0.2s; }
    .links-container a:hover { background: #007bff; color: #fff; }
    #chatBubble { position: fixed; bottom: 20px; right: 20px; width: 64px; height: 64px; border-radius: 50%; background: #007bff; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.25); z-index: 9999; }
    #chatBubble span { font-size: 10px; margin-top: 2px; max-width: 55px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    #chatBadge { position: absolute; top: 6px; right: 6px; background: red; color: white; font-size: 10px; padding: 2px 6px; border-radius: 50%; display: none; }
  </style>
</head>
<body>

  <!-- Sidebar with Navigation Links -->
  <div class="sidebar">
    <div class="sidebar-scroll">
      <button class="btn" onclick="loadPage('create-bot.html')">‚öôÔ∏è Create a Bot</button>
      <button class="btn" onclick="loadPage('marketplace.html')">üõí Marketplace</button>
      <button class="btn" onclick="loadPage('explore.html')">üîç Explore Bots</button>
      <button class="btn" onclick="loadPage('index.html')">üè† Home</button>
      <button class="btn" onclick="loadPage('login.html')">üîó Login</button>
      <button class="btn" onclick="loadPage('signup.html')">Signup</button>
      <button class="btn" onclick="loadPage('boteos.html')">ü§£ Boteos</button>
      <button class="btn" onclick="loadPage('dialogue.html')">üôá Dialogue</button>
      <button class="btn" onclick="loadPage('email.html')">üöì Email</button>
      <button class="btn" onclick="loadPage('settings.html')">üéá Settings</button>
      <button class="btn" onclick="loadPage('site-builder.html')">üõ† Site Builder</button>
      <button class="btn" onclick="loadPage('recovery.html')">üîó Recovery</button>
      <button class="btn" onclick="loadPage('video.html')">üîä Media Dashboard</button>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="content">
    <div class="profile-header" id="profile"></div>

    <h1>ü§ñ Create Your Bot</h1>

    <form id="botForm">
      <input type="text" id="botName" placeholder="Bot Name" required />
      <textarea id="description" placeholder="Describe your bot..." required></textarea>

      <label for="voiceSelect">Select Voice:</label>
      <select id="voiceSelect" required><option value="">Loading voices...</option></select>

      <label for="fbxSelect">Select FBX Model:</label>
      <select id="fbxSelect" required><option value="">Choose FBX Model</option></select>

      <input type="text" id="gumroadLink" placeholder="Optional Gumroad Link for paid model" />
      <button type="submit">Create Bot</button>
    </form>

    <div id="output" class="output"></div>

    <h2>Incoming Friend Requests</h2>
    <div id="incomingRequests"></div>

    <input type="email" id="friendEmail" placeholder="Friend's Email">
    <button id="sendRequestBtn">Send Friend Request</button>

    <div class="links-container">
      <nav>
        <a href="/create.html?user=@scoobydo">‚öôÔ∏è Create a Bot</a>
        <a href="/marketplace.html?character=scoobydo">üõí Marketplace</a>
        <a href="/explore.html?user=@scoobydo">üîç Explore Bots</a>
        <a href="/index.html?user=@scoobydo">üè† Home</a>
        <a href="/login.html?redirect=user=@scoobydo">üîó Login</a>
        <a href="signup.html">Signup</a>
        <a href="page/index.html?ref=@scoobydoo">ü§£ Boteos</a>
        <a href="dialogue.html?ref=@fortniteCod6">üôá Dialogue</a>
        <a href="email.html?ref=@dude">üöì Email</a>
        <a href="fullSettings.html?ref=@nathenisdiddy">üéá Settings</a>
        <a href="site-builder.html?ref=@IsaiahIsStraight">üéá Site Builder</a>
        <a href="recovery-login.html?ref=@recovery-login">üîó Recovery Login</a>
        <a href="video.html?ref=@video-page">üéá Video Page</a>
      </nav>
    </div>

    <!-- Chat Bubble -->
    <div id="chatBubble" onclick="openChat()">
      üí¨
      <span id="chatUsername">Chat</span>
      <div id="chatBadge">!</div>
    </div>
  </div>

  <script>
    // -----------------------
    // SHOW TEST ACCOUNT ALERT
    // -----------------------
    window.addEventListener('DOMContentLoaded', () => {});

    // -----------------------
    // PAGE LOADING
    // -----------------------
    function loadPage(pageUrl) {
      // Show loading state
      document.querySelector('.content').innerHTML = "<div class='loading'>Loading...</div>";

      // Load HTML content
      fetch(pageUrl)
        .then(response => response.text())
        .then(html => {
          // Inject the HTML content into the page
          document.querySelector('.content').innerHTML = html;

          // Manually load external CSS if necessary
          const cssLink = document.createElement('link');
          cssLink.rel = 'stylesheet';
          cssLink.href = pageUrl.replace('.html', '.css'); // Assuming the CSS file has the same name as the HTML
          document.head.appendChild(cssLink);

          // Manually load external JS if necessary
          const script = document.createElement('script');
          script.src = pageUrl.replace('.html', '.js'); // Assuming the JS file has the same name as the HTML
          script.onload = () => {
            console.log(`Successfully loaded script for ${pageUrl}`);
            // Reinitialize any necessary functions here
            initializeNetlifyFunctions();  // Make sure your Netlify Functions get triggered
          };
          document.body.appendChild(script);
        })
        .catch(error => {
          console.error("Error loading page:", error);
          document.querySelector('.loading').innerText = 'Error loading page!';
        });
    }

    // -----------------------
    // PROFILE LOADING
    // -----------------------
    async function loadProfile() {
      try {
        const res = await fetch('/.netlify/functions/profileCreation', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include'
        });
        const result = await res.json();
        if (!result.success) throw new Error(result.error || 'Failed to fetch user');

        const user = result.user;
        window.userEmail = user.email;

        const lastActive = new Date(user.last_online);
        const online = (Date.now() - lastActive.getTime()) < 5*60*1000 ? 'online' : 'offline';
        const avatarUrl = user.profile_picture || `https://avatars.dicebear.com/api/initials/${encodeURIComponent(user.email)}.svg`;

        document.getElementById('profile').innerHTML = `
          <img src="${avatarUrl}" alt="Profile" />
          <span>${user.username || user.email} - <span class="${online}">${online}</span></span>
        `;
        document.getElementById('chatUsername').textContent = user.username || user.email;
      } catch(e) {
        console.error('Failed to load profile', e);
      }
    }

    // -----------------------
    // FRIEND REQUEST HANDLING
    // -----------------------
    async function loadIncoming() {
      try {
        const res = await fetch('/.netlify/functions/friend-requests', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ action:'list', user_email: window.userEmail })
        });
        const data = await res.json();
        const container = document.getElementById('incomingRequests');
        container.innerHTML = '';
        data.forEach(req => {
          const div = document.createElement('div');
          div.innerHTML = `<span>${req.sender_email}</span>
            <button onclick="respond('${req.id}','accepted')">Accept</button>
            <button onclick="respond('${req.id}','rejected')">Reject</button>`;
          container.appendChild(div);
        });
      } catch(e){ console.error(e); }
    }

    window.respond = async (id,status) => {
      const res = await fetch('/.netlify/functions/friend-requests', {
        method: 'POST',
        headers:{'Content-Type':'application/json'},
        credentials: 'include',
        body: JSON.stringify({ action:'respond', request_id:id, status })
      });
      const data = await res.json();
      alert(data.success ? `Request ${status}` : data.error);
      loadIncoming();
    }

    document.getElementById('sendRequestBtn').addEventListener('click', async () => {
      const receiver_email = document.getElementById('friendEmail').value;
      const res = await fetch('/.netlify/functions/friend-requests', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        credentials: 'include',
        body: JSON.stringify({ action:'send', sender_email: window.userEmail, receiver_email })
      });
      const data = await res.json();
      alert(data.success ? 'Request sent!' : data.error);
      loadIncoming();
    });

    // -----------------------
    // BOT CREATION
    // -----------------------
    const form = document.getElementById('botForm');
    const output = document.getElementById('output');
    const voiceSelect = document.getElementById('voiceSelect');
    const fbxSelect = document.getElementById('fbxSelect');

    async function loadVoices() {
      try {
        const res = await fetch('/.netlify/functions/get-voices', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          credentials: 'include'
        });
        const voices = await res.json();
        voiceSelect.innerHTML = '<option value="">Select Voice</option>';
        voices.forEach(v => {
          const opt = document.createElement('option');
          opt.value = v.id;
          opt.textContent = `${v.name} (${v.lang})`;
          voiceSelect.appendChild(opt);
        });
      } catch(err) {
        voiceSelect.innerHTML = '<option value="">Failed to load voices</option>';
        console.error(err);
      }
    }

    const fbxModels = [
      {id:'model1',name:'Humanoid Default'},
      {id:'model2',name:'Robot Model'}
    ];
    fbxModels.forEach(m => {
      const opt = document.createElement('option');
      opt.value = m.id;
      opt.textContent = m.name;
      fbxSelect.appendChild(opt);
    });

    form.addEventListener('submit', async e => {
      e.preventDefault();
      const name = document.getElementById('botName').value.trim();
      const description = document.getElementById('description').value.trim();
      const voice_id = voiceSelect.value;
      const fbx_model_id = fbxSelect.value;
      const paid_link = document.getElementById('gumroadLink').value.trim();

      if(!name || !description || !voice_id || !fbx_model_id){
        output.textContent='Please fill all required fields.'; 
        output.className='output error'; 
        return;
      }

      output.textContent='Creating bot...'; 
      output.className='output';

      try {
        const res = await fetch('/.netlify/functions/overpoweredbot', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          credentials: 'include',
          body: JSON.stringify({ name, description, voice_id, fbx_model_id, paid_link })
        });
        const data = await res.json();
        if(!res.ok || data.error){ 
          output.textContent=`Error: ${data.error||'Unknown'}`; 
          output.className='output error'; 
          return; 
        }
        output.innerHTML=`<strong>Bot Created Successfully!</strong><br>ID/Hash: ${data.id||'N/A'}<br>API Key: ${data.apiKey||'Check Backend'}<br>File: bot.js<br><br>
          <a href="/explore.html">üîç Explore</a> | <a href="/index.html">üè† Home</a>`;
        output.className='output success'; 
        form.reset();
      } catch(err){
        output.textContent='Failed to create bot.'; 
        output.className='output error';
      }
    });

    // -----------------------
    // CHAT NAVIGATION
    // -----------------------
    function openChat() { window.location.href = '/chat.html'; }

    // -----------------------
    // INITIAL LOAD
    // -----------------------
    loadProfile().then(loadIncoming).then(loadVoices);
  </script>

</body>
</html>
