<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Friend Requests & Create Bot ‚Äî Botnev</title>
<meta name="description" content="Manage friend requests and create your own AI bot on Botnev! Customize your bot, select voices, and models.">

<link rel="icon" type="image/png" sizes="32x32" href="https://botnet2.netlify.app/assets/logo.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://botnet2.netlify.app/assets/logo.png">

<meta property="og:title" content="Friend Requests & Create Bot ‚Äî Botnev">
<meta property="og:description" content="Manage friend requests and create your own AI bot on Botnev! Customize your bot, select voices, and models.">
<meta property="og:image" content="https://botnet2.netlify.app/assets/og-image.png">
<meta property="og:url" content="https://botnet2.netlify.app/create-bot.html">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Friend Requests & Create Bot ‚Äî Botnev">
<meta name="twitter:description" content="Manage friend requests and create your own AI bot on Botnev! Customize your bot, select voices, and models.">
<meta name="twitter:image" content="https://botnet2.netlify.app/assets/og-image.png">

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Friend Requests & Create Bot ‚Äî Botnev",
  "url": "https://botnet2.netlify.app/create-bot.html",
  "description": "Manage friend requests and create your own AI bot on Botnev! Customize your bot, select voices, and models.",
  "publisher": {
    "@type": "Organization",
    "name": "Botnev",
    "logo": { "@type": "ImageObject", "url": "https://botnet2.netlify.app/assets/logo.png" }
  }
}
</script>

<!-- Tailwind + DaisyUI -->
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.3/dist/tailwind.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/daisyui@3.3.3/dist/full.css" rel="stylesheet">
</head>
<body class="flex h-screen bg-base-200 font-sans">

<!-- Sidebar -->
<nav class="w-56 bg-gray-900 text-white flex flex-col p-5 space-y-2">
  <div class="text-center mb-6">
    <img src="https://botnet2.netlify.app/assets/logo.png" alt="Botnev Logo" class="w-28 mx-auto cursor-pointer transition-transform duration-300 hover:scale-105 rounded-lg" onclick="loadPage('index.html')">
  </div>
  <a class="btn btn-ghost w-full justify-start" onclick="loadPage('create-bot.html')">‚öôÔ∏è Create a Bot</a>
  <a class="btn btn-ghost w-full justify-start" onclick="loadPage('marketplace.html')">üõí Marketplace</a>
  <a class="btn btn-ghost w-full justify-start" onclick="loadPage('explore.html')">üîç Explore Bots</a>
  <a class="btn btn-ghost w-full justify-start" onclick="loadPage('index.html')">üè† Home</a>
  <a class="btn btn-ghost w-full justify-start" onclick="loadPage('login.html')">üîó Login</a>
  <a class="btn btn-ghost w-full justify-start" onclick="loadPage('signup.html')">Signup</a>
  <a class="btn btn-ghost w-full justify-start" onclick="loadPage('boteos.html')">ü§£ Boteos</a>
  <a class="btn btn-ghost w-full justify-start" onclick="loadPage('dialogue.html')">üôá Dialogue</a>
  <a class="btn btn-ghost w-full justify-start" onclick="loadPage('email.html')">üöì Email</a>
  <a class="btn btn-ghost w-full justify-start" onclick="loadPage('settings.html')">üéá Settings</a>
  <a class="btn btn-ghost w-full justify-start" onclick="loadPage('site-builder.html')">üõ† Site Builder</a>
  <a class="btn btn-ghost w-full justify-start" onclick="loadPage('recovery.html')">üîó Recovery</a>
  <a class="btn btn-ghost w-full justify-start" onclick="loadPage('video.html')">üîä Video Page</a>
</nav>

<!-- Main Content -->
<main class="flex-1 overflow-y-auto p-6">
  <header class="text-center mb-6">
    <a href="/index.html"><img src="https://botnet2.netlify.app/assets/logo.png" alt="Botnev Logo" class="mx-auto max-w-xs transition-transform duration-300 hover:scale-105 rounded-lg" id="topLogo" /></a>
  </header>

  <div class="flex items-center justify-center gap-4 mb-6" id="profile"></div>

  <h1 class="text-2xl font-semibold mb-4">ü§ñ Create Your Bot</h1>
  <form id="botForm" class="max-w-md mx-auto bg-base-100 p-6 rounded-lg shadow-lg space-y-4">
    <input type="text" id="botName" placeholder="Bot Name" class="input input-bordered w-full" required />
    <textarea id="description" placeholder="Describe your bot..." class="textarea textarea-bordered w-full" required></textarea>

    <label for="voiceSelect" class="block mb-1 font-medium">Select Voice:</label>
    <select id="voiceSelect" class="select select-bordered w-full" required>
      <option value="">Loading voices...</option>
    </select>

    <label for="fbxSelect" class="block mb-1 font-medium">Select FBX Model:</label>
    <select id="fbxSelect" class="select select-bordered w-full" required>
      <option value="">Choose FBX Model</option>
    </select>

    <input type="text" id="gumroadLink" placeholder="Optional Gumroad Link for paid model" class="input input-bordered w-full" />
    <button type="submit" class="btn btn-primary w-full">Create Bot</button>
  </form>

  <div id="output" class="mt-4 font-mono p-3 rounded bg-base-200"></div>

  <h2 class="text-xl font-semibold mt-8 mb-4">Incoming Friend Requests</h2>
  <div id="incomingRequests" class="space-y-2"></div>

  <input type="email" id="friendEmail" placeholder="Friend's Email" class="input input-bordered w-full max-w-md mb-2" />
  <button id="sendRequestBtn" class="btn btn-primary">Send Friend Request</button>
</main>

<!-- Chat Bubble -->
<div id="chatBubble" class="fixed bottom-5 right-5 w-16 h-16 rounded-full bg-primary text-white flex flex-col items-center justify-center cursor-pointer shadow-lg z-50" onclick="openChat()">
  üí¨
  <span id="chatUsername" class="text-xs mt-1 truncate max-w-[55px]">Chat</span>
  <div id="chatBadge" class="absolute top-1 right-1 bg-red-500 text-white text-xs px-1.5 py-0.5 rounded-full hidden">!</div>
</div>

<script>
/* --- Load User Profile --- */
async function loadProfile() {
  try {
    const res = await fetch('/.netlify/functions/profileCreation', { method:'POST', headers:{'Content-Type':'application/json'}, credentials:'include' });
    const result = await res.json();
    if(!result.success) throw new Error(result.error || 'Failed to fetch user');
    const user = result.user;
    window.userEmail = user.email;
    const lastActive = new Date(user.last_online);
    const online = (Date.now() - lastActive.getTime()) < 5*60*1000 ? 'online':'offline';
    const avatarUrl = user.profile_picture || `https://avatars.dicebear.com/api/initials/${encodeURIComponent(user.email)}.svg`;
    document.getElementById('profile').innerHTML = `<img src="${avatarUrl}" alt="Profile" class="w-12 h-12 rounded-full"/><span>${user.username||user.email} - <span class="${online}">${online}</span></span>`;
    document.getElementById('chatUsername').textContent = user.username||user.email;
  } catch(e){ console.error(e); }
}

/* --- Load Friend Requests --- */
async function loadIncoming() {
  try {
    const res = await fetch('/.netlify/functions/friend-requests', { method:'POST', headers:{'Content-Type':'application/json'}, credentials:'include', body: JSON.stringify({action:'list', user_email: window.userEmail})});
    const data = await res.json();
    const container = document.getElementById('incomingRequests');
    container.innerHTML='';
    data.forEach(req=>{
      const div = document.createElement('div');
      div.className='flex items-center justify-between bg-base-100 p-2 rounded shadow';
      div.innerHTML=`<span>${req.sender_email}</span><div><button onclick="respond('${req.id}','accepted')" class="btn btn-xs btn-success mr-1">Accept</button><button onclick="respond('${req.id}','rejected')" class="btn btn-xs btn-error">Reject</button></div>`;
      container.appendChild(div);
    });
  } catch(e){ console.error(e); }
}

/* --- Respond to Friend Request --- */
window.respond=async(id,status)=>{
  const res = await fetch('/.netlify/functions/friend-requests',{method:'POST', headers:{'Content-Type':'application/json'}, credentials:'include', body:JSON.stringify({action:'respond', request_id:id, status})});
  const data = await res.json();
  alert(data.success?`Request ${status}`:data.error);
  loadIncoming();
}

/* --- Send Friend Request --- */
document.getElementById('sendRequestBtn').addEventListener('click',async()=>{
  const receiver_email=document.getElementById('friendEmail').value;
  const res=await fetch('/.netlify/functions/friend-requests',{method:'POST', headers:{'Content-Type':'application/json'}, credentials:'include', body:JSON.stringify({action:'send', sender_email:window.userEmail, receiver_email})});
  const data=await res.json();
  alert(data.success?'Request sent!':data.error);
  loadIncoming();
});

/* --- Bot Form --- */
const form=document.getElementById('botForm');
const output=document.getElementById('output');
const voiceSelect=document.getElementById('voiceSelect');
const fbxSelect=document.getElementById('fbxSelect');

/* --- Load Voices --- */
async function loadVoices(){
  try{
    const res=await fetch('/.netlify/functions/get-voices',{method:'POST', headers:{'Content-Type':'application/json'}, credentials:'include'});
    const voices=await res.json();
    voiceSelect.innerHTML='<option value="">Select Voice</option>';
    voices.forEach(v=>{ const opt=document.createElement('option'); opt.value=v.id; opt.textContent=`${v.name} (${v.lang})`; voiceSelect.appendChild(opt); });
  }catch(err){voiceSelect.innerHTML='<option value="">Failed to load voices</option>'; console.error(err);}
}

/* --- FBX Models --- */
const fbxModels=[{id:'model1',name:'Humanoid Default'},{id:'model2',name:'Robot Model'}];
fbxModels.forEach(m=>{const opt=document.createElement('option'); opt.value=m.id; opt.textContent=m.name; fbxSelect.appendChild(opt);});

/* --- Submit Bot Form --- */
form.addEventListener('submit',async e=>{
  e.preventDefault();
  const name=document.getElementById('botName').value.trim();
  const description=document.getElementById('description').value.trim();
  const voice_id=voiceSelect.value;
  const fbx_model_id=fbxSelect.value;
  const paid_link=document.getElementById('gumroadLink').value.trim();
  if(!name||!description||!voice_id||!fbx_model_id){output.textContent='Please fill all required fields.'; output.className='mt-4 font-mono p-3 rounded bg-red-100 text-red-700'; return;}
  output.textContent='Creating bot...'; output.className='mt-4 font-mono p-3 rounded bg-base-200';
  try{
    const res=await fetch('/.netlify/functions/overpoweredbot',{method:'POST', headers:{'Content-Type':'application/json'}, credentials:'include', body:JSON.stringify({name, description, voice_id, fbx_model_id, paid_link})});
    const data=await res.json();
    if(!res.ok||data.error){ output.textContent=`Error: ${data.error||'Unknown'}`; output.className='mt-4 font-mono p-3 rounded bg-red-100 text-red-700'; return;}
    output.innerHTML=`<strong>Bot Created Successfully!</strong><br>ID/Hash: ${data.id||'N/A'}<br>API Key: ${data.apiKey||'Check Backend'}<br>File: bot.js<br><br><a href="/explore.html" class="link link-primary">üîç Explore</a> | <a href="/index.html" class="link link-primary">üè† Home</a>`;
    output.className='mt-4 font-mono p-3 rounded bg-green-100 text-green-700';
    form.reset();
  }catch(err){output.textContent='Failed to create bot.'; output.className='mt-4 font-mono p-3 rounded bg-red-100 text-red-700';}
});

/* --- Chat --- */
function openChat(){window.location.href='/chat.html';}

/* --- SPA Page Load --- */
function loadPage(page){ window.location.href = '/' + page; }

/* --- Init --- */
loadProfile().then(loadIncoming).then(loadVoices);
</script>

</body>
</html>
