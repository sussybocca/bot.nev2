<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Botnev Dashboard</title>
  <meta name="description" content="Manage your bots, media, and settings on Botnev Dashboard. Create bots, explore the marketplace, and more.">
  <meta name="keywords" content="Botnev, bot dashboard, bots, media, MP3, MP4, manage bots, dashboard">
  <meta name="author" content="Botnev Team">

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="https://botnet2.netlify.app/assets/logo.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://botnet2.netlify.app/assets/logo.png">

  <!-- Open Graph / Facebook -->
  <meta property="og:title" content="Botnev Dashboard">
  <meta property="og:description" content="Manage bots, videos, music, and settings on Botnev Dashboard.">
  <meta property="og:image" content="https://botnet2.netlify.app/assets/og-image.png">
  <meta property="og:url" content="https://botnet2.netlify.app/dashboard.html">
  <meta property="og:type" content="website">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Botnev Dashboard">
  <meta name="twitter:description" content="Manage bots, videos, music, and settings on Botnev Dashboard.">
  <meta name="twitter:image" content="https://botnet2.netlify.app/assets/og-image.png">

  <!-- JSON-LD Schema -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Botnev Dashboard",
      "url": "https://botnet2.netlify.app/dashboard.html",
      "description": "Manage bots, videos, music, and settings on Botnev Dashboard.",
      "publisher": {
        "@type": "Organization",
        "name": "Botnev",
        "logo": { "@type": "ImageObject", "url": "https://botnet2.netlify.app/assets/logo.png" }
      }
    }
  </script>

  <!-- Tailwind CSS & DaisyUI -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.3/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/daisyui@3.3.3/dist/full.css" rel="stylesheet">

<style>
  body {
    scroll-behavior: smooth;
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #f3f4f6, #d1d5db); /* Light gradient from white to gray */
  }

  .sidebar-scroll {
    overflow-y: auto;
    max-height: calc(100vh - 80px);
  }

  .video-list,
  .audio-list {
    max-height: 150px;
    overflow-y: auto;
  }

  .nav-btn {
    transition: all 0.2s ease-in-out;
  }

  .nav-btn:hover {
    transform: scale(1.05);
    background-color: #7c3aed;
    color: white;
  }

  .output {
    font-family: monospace;
    padding: 10px;
    border-radius: 6px;
    margin-top: 10px;
  }

  .output.success {
    background: #e6ffed;
    color: #256d1b;
    border: 1px solid #8dd48a;
  }

  .output.error {
    background: #ffe6e6;
    color: #a12626;
    border: 1px solid #f5a3a3;
  }

  .rounded-btn {
    transition: all 0.2s ease-in-out;
  }

  .rounded-btn:hover {
    transform: scale(1.05);
    background-color: #4c1d95;
    color: white;
  }

  .chat-bubble {
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 50px;
    height: 50px;
    background-color: #7c3aed;
    position: fixed;
    bottom: 10px;
    right: 10px;
    cursor: pointer;
    color: white;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    z-index: 50;
  }

  .chat-bubble span {
    font-size: 12px;
  }

  .chat-bubble:hover {
    background-color: #6b21a8;
  }

  .badge {
    position: absolute;
    top: 0;
    right: 0;
    background-color: red;
    color: white;
    padding: 4px;
    border-radius: 50%;
    font-size: 10px;
  }
</style>
</head>

<body class="flex h-screen bg-gradient-to-r from-purple-100 via-white to-blue-100">

  <!-- Sidebar -->
  <aside class="w-64 bg-white shadow-lg p-4 flex flex-col">
    <div class="text-center mb-6">
    </div>
    <div class="sidebar-scroll flex-1 space-y-3">
      <button class="btn btn-outline w-full rounded-btn" onclick="loadPage('create-bot.html')">‚öôÔ∏è Create a Bot</button>
      <button class="btn btn-outline w-full rounded-btn" onclick="loadPage('marketplace.html')">üõí Marketplace</button>
      <button class="btn btn-outline w-full rounded-btn" onclick="loadPage('explore.html')">üîç Explore Bots</button>
      <button class="btn btn-outline w-full rounded-btn" onclick="loadPage('index.html')">üè† Home</button>
      <button class="btn btn-outline w-full rounded-btn" onclick="loadPage('login.html')">üîó Login</button>
      <button class="btn btn-outline w-full rounded-btn" onclick="loadPage('signup.html')">Signup</button>
      <button class="btn btn-outline w-full rounded-btn" onclick="loadPage('boteos.html')">ü§£ Boteos</button>
      <button class="btn btn-outline w-full rounded-btn" onclick="loadPage('dialogue.html')">üôá Dialogue</button>
      <button class="btn btn-outline w-full rounded-btn" onclick="loadPage('email.html')">üöì Email</button>
      <button class="btn btn-outline w-full rounded-btn" onclick="loadPage('settings.html')">üéá Settings</button>
      <button class="btn btn-outline w-full rounded-btn" onclick="loadPage('site-builder.html')">üõ† Site Builder</button>
      <button class="btn btn-outline w-full rounded-btn" onclick="loadPage('recovery.html')">üîó Recovery</button>
      <button class="btn btn-outline w-full rounded-btn" onclick="loadPage('video.html')">üîä Media Dashboard</button>
    </div>
  </aside>

  <!-- Main Content -->
  <main id="mainContent" class="flex-1 p-6 overflow-y-auto">
    <header class="flex items-center justify-between mb-6">
      <img src="https://botnet2.netlify.app/assets/logo.png" alt="Botnev Logo"
        class="w-32 cursor-pointer rounded-lg hover:scale-105 transition-transform" onclick="loadPage('index.html')">
      <div id="profile" class="flex items-center gap-2"></div>
    </header>

    <div class="text-center text-gray-500 mt-20">
      <h2 class="text-3xl font-bold">Welcome to Botnev Dashboard</h2>
      <p class="mt-2">Manage bots, videos, and media effortlessly from the dashboard.</p>
    </div>

    <!-- Media Players -->
    <div id="mediaPlayers" class="mt-10">
      <!-- MP3 Player -->
      <div id="mp3Player" class="mb-10">
        <h3 class="text-xl font-semibold">Background Music</h3>
        <select id="mp3Select" class="mt-4 w-full p-2 border border-gray-300 rounded" onchange="playMP3()">
          <!-- MP3 options will be populated dynamically -->
        </select>
        <audio id="audioPlayer" controls class="w-full mt-4">
          <source id="audioSource" type="audio/mp3">
        </audio>
      </div>

      <!-- MP4 Player -->
      <div id="mp4Player" class="mb-10">
        <h3 class="text-xl font-semibold">Background Video</h3>
        <select id="mp4Select" class="mt-4 w-full p-2 border border-gray-300 rounded" onchange="playMP4()">
          <!-- MP4 options will be populated dynamically -->
        </select>
        <video id="videoPlayer" controls class="w-full mt-4">
          <source id="videoSource" type="video/mp4">
        </video>
      </div>
    </div>

    <!-- Friend Requests Section -->
    <div id="incomingRequests" class="space-y-3 mt-6">
      <h3 class="text-xl font-semibold">Incoming Friend Requests</h3>
      <!-- Requests will be dynamically loaded here -->
    </div>

  </main>

  <!-- Chat Bubble -->
  <div id="chatBubble" class="chat-bubble" onclick="openChat()">
    üí¨
    <span id="chatUsername" class="text-xs mt-1">Chat</span>
    <div id="chatBadge" class="badge hidden">!</div>
  </div>

  <script>
    // ------------------------
    // SPA Page Loader 
    async function loadPage(page) {
      try {
        const res = await fetch('/' + page);
        if (!res.ok) throw new Error('Page not found');
        const html = await res.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        document.getElementById('mainContent').innerHTML = doc.body.innerHTML;
        if (typeof initPage === 'function') initPage(); // Reattach events for dynamic content
        window.scrollTo(0, 0);
      } catch (err) {
        console.error(err);
        document.getElementById('mainContent').innerHTML = `<p class="text-red-500">Failed to load page: ${err.message}</p>`;
      }
    }

    // ------------------------
    // Media Fetching
    async function fetchMedia() {
      const response = await fetch('/.netlify/functions/medialist.js');
      const data = await response.json();

      const mp3Select = document.getElementById('mp3Select');
      const mp4Select = document.getElementById('mp4Select');

      // Populate MP3 options
      data.mediaFiles.filter(file => file.name.endsWith('.mp3')).forEach(file => {
        const option = document.createElement('option');
        option.value = file.download_url;
        option.textContent = file.name;
        mp3Select.appendChild(option);
      });

      // Populate MP4 options
      data.mediaFiles.filter(file => file.name.endsWith('.mp4')).forEach(file => {
        const option = document.createElement('option');
        option.value = file.download_url;
        option.textContent = file.name;
        mp4Select.appendChild(option);
      });
    }

    // ------------------------
    // Media Playback
    function playMP3() {
      const audioPlayer = document.getElementById('audioPlayer');
      const audioSource = document.getElementById('audioSource');
      const mp3Select = document.getElementById('mp3Select');
      audioSource.src = mp3Select.value;
      audioPlayer.load();
      audioPlayer.play();
    }

    function playMP4() {
      const videoPlayer = document.getElementById('videoPlayer');
      const videoSource = document.getElementById('videoSource');
      const mp4Select = document.getElementById('mp4Select');
      videoSource.src = mp4Select.value;
      videoPlayer.load();
      videoPlayer.play();
    }

    // ------------------------
    // Profile Loader
    async function loadProfile() {
      try {
        const res = await fetch('/.netlify/functions/profileCreation', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include'
        });
        const result = await res.json();
        if (!result.success) throw new Error(result.error || 'Failed to fetch user');

        const user = result.user;
        window.userEmail = user.email;

        const lastActive = new Date(user.last_online);
        const online = (Date.now() - lastActive.getTime()) < 5 * 60 * 1000 ? 'online' : 'offline';
        const avatarUrl = user.profile_picture || `https://avatars.dicebear.com/api/initials/${encodeURIComponent(user.email)}.svg`;

        document.getElementById('profile').innerHTML = `
          <img src="${avatarUrl}" alt="Profile" class="w-12 h-12 rounded-full" />
          <span>${user.username || user.email} - <span class="${online}">${online}</span></span>
        `;
        document.getElementById('chatUsername').textContent = user.username || user.email;
      } catch (e) {
        console.error('Failed to load profile', e);
      }
    }

    // ------------------------
    // Friend Requests
    async function loadIncoming() {
      try {
        const res = await fetch('/.netlify/functions/friend-requests', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ action: 'list', user_email: window.userEmail })
        });
        const data = await res.json();
        const container = document.getElementById('incomingRequests');
        container.innerHTML = '';
        data.forEach(req => {
          const div = document.createElement('div');
          div.innerHTML = `<span>${req.sender_email}</span>
            <button onclick="respond('${req.id}','accepted')">Accept</button>
            <button onclick="respond('${req.id}','rejected')">Reject</button>`;
          container.appendChild(div);
        });
      } catch (e) { console.error(e); }
    }

    window.respond = async (id, status) => {
      const res = await fetch('/.netlify/functions/friend-requests', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ action: 'respond', request_id: id, status })
      });
      const data = await res.json();
      alert(data.success ? `Request ${status}` : data.error);
      loadIncoming();
    }

    // ------------------------
    // Bot Creation
    const form = document.getElementById('botForm');
    const output = document.getElementById('output');
    const voiceSelect = document.getElementById('voiceSelect');
    const fbxSelect = document.getElementById('fbxSelect');

    async function loadVoices() {
      try {
        const res = await fetch('/.netlify/functions/get-voices', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include'
        });
        const voices = await res.json();
        voiceSelect.innerHTML = '<option value="">Select Voice</option>';
        voices.forEach(v => {
          const opt = document.createElement('option');
          opt.value = v.id;
          opt.textContent = `${v.name} (${v.lang})`;
          voiceSelect.appendChild(opt);
        });
      } catch (err) {
        voiceSelect.innerHTML = '<option value="">Failed to load voices</option>';
        console.error(err);
      }
    }

    const fbxModels = [
      { id: 'model1', name: 'Humanoid Default' },
      { id: 'model2', name: 'Robot Model' }
    ];
    fbxModels.forEach(m => {
      const opt = document.createElement('option');
      opt.value = m.id;
      opt.textContent = m.name;
      fbxSelect.appendChild(opt);
    });

    form.addEventListener('submit', async e => {
      e.preventDefault();
      const name = document.getElementById('botName').value.trim();
      const description = document.getElementById('description').value.trim();
      const voice_id = voiceSelect.value;
      const fbx_model_id = fbxSelect.value;
      const paid_link = document.getElementById('gumroadLink').value.trim();

      if (!name || !description || !voice_id || !fbx_model_id) {
        output.textContent = 'Please fill all required fields.';
        output.className = 'output error';
        return;
      }

      output.textContent = 'Creating bot...';
      output.className = 'output';

      try {
        const res = await fetch('/.netlify/functions/overpoweredbot', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ name, description, voice_id, fbx_model_id, paid_link })
        });
        const data = await res.json();
        if (!res.ok || data.error) {
          output.textContent = `Error: ${data.error || 'Unknown'}`;
          output.className = 'output error';
          return;
        }
        output.innerHTML = `<strong>Bot Created Successfully!</strong><br>ID/Hash: ${data.id || 'N/A'}<br>API Key: ${data.apiKey || 'Check Backend'}<br>File: bot.js<br><br>
          <a href="/explore.html">üîç Explore</a> | <a href="/index.html">üè† Home</a>`;
        output.className = 'output success';
        form.reset();
      } catch (err) {
        output.textContent = 'Failed to create bot.';
        output.className = 'output error';
      }
    });

    // ------------------------
    // Chat Navigation
    function openChat() { window.location.href = '/chat.html'; }

    // ------------------------
    // Initial Load
    loadProfile().then(loadIncoming).then(loadVoices);
  </script>

</body>

</html>
